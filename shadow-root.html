<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Anchor Positioning Polyfill</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/prismjs@v1.x/themes/prism.css"
    />
    <script
      src="https://unpkg.com/@oddbird/popover-polyfill@latest/dist/popover.min.js"
      crossorigin="anonymous"
      defer
    ></script>
    <!-- TypeKit Fonts -->
    <script src="https://use.typekit.net/slx1xnq.js"></script>
    <script>
      try {
        Typekit.load({ async: true });
      } catch (e) {}
    </script>
    <link rel="stylesheet" href="/demo.css" />
    <style>
      anchor-web-component {
        width: 100%;
      }
    </style>
    <script type="module">
      import polyfill from '/src/index-fn.ts';

      const SUPPORTS_ANCHOR_POSITIONING =
        'anchorName' in document.documentElement.style;

      const btn = document.getElementById('apply-polyfill');

      if (!SUPPORTS_ANCHOR_POSITIONING) {
        btn.addEventListener('click', () => {
          document
            .querySelector('anchor-web-component')
            .applyPolyfill()
            .then(() => {
              btn.innerText = 'Polyfill Applied';
              btn.setAttribute('disabled', '');
            });
        });
      } else {
        btn.innerText = 'No Polyfill Needed';
        btn.setAttribute('disabled', '');
        console.log(
          'anchor-positioning is supported in this browser; polyfill skipped.',
        );
      }

      class AnchorWebComponent extends HTMLElement {
        /* This would typically be run in connectedCallback() */
        applyPolyfill() {
          const stylesheets = this.shadowRoot.querySelectorAll('link');
          return polyfill.call(this, { elements: [...stylesheets] });
        }
      }
      customElements.define('anchor-web-component', AnchorWebComponent);
    </script>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script>
    <script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script>
    <script
      defer
      data-domain="anchor-positioning.oddbird.net"
      src="https://plausible.io/js/script.hash.outbound-links.js"
    ></script>
  </head>
  <body>
    <header>
      <h1><a href="/">CSS Anchor Positioning Polyfill</a></h1>
      <nav>
        <span> See also: </span>
        <a
          href="https://github.com/web-platform-tests/wpt/tree/master/css/css-anchor-position"
          target="_blank"
          rel="noopener noreferrer"
          >WPT examples</a
        >
        <!-- <a
          href="https://anchor-position-wpt.netlify.app/"
          target="_blank"
          rel="noopener noreferrer"
          >WPT results</a
        > -->
        <a
          href="https://drafts.csswg.org/css-anchor-position/"
          target="_blank"
          rel="noopener noreferrer"
          >Draft Spec</a
        >
      </nav>
      <button id="apply-polyfill" data-button="apply-polyfill" type="button">
        Apply Polyfill
      </button>
    </header>
    <section>
      <h2>Anchoring Elements Using CSS</h2>
      <p>
        The CSS anchor positioning
        <a
          href="https://drafts.csswg.org/css-anchor-position/"
          target="_blank"
          rel="noopener noreferrer"
          >specification</a
        >
        defines anchor positioning, ‚Äúwhere a positioned element can size and
        position itself relative to one or more ‚Äòanchor elements‚Äô elsewhere on
        the page.‚Äù This CSS Anchor Positioning Polyfill supports and is based on
        this specification.
      </p>
      <p>
        The proposed <code>anchor()</code> and
        <code>anchor-size()</code> functions add flexibility to how absolutely
        positioned elements can be placed within a layout. Instead of being
        sized and positioned based solely on the position of their containing
        block, the proposed new functions allow absolutely positioned elements
        to be placed relative to one or more author-defined anchor elements.
      </p>
      <ul>
        <li>
          View the polyfill on
          <a
            href="https://github.com/oddbird/css-anchor-positioning"
            target="_blank"
            rel="noopener noreferrer"
            >GitHub</a
          >
          or browse
          <a
            href="https://github.com/oddbird/css-anchor-positioning/issues"
            target="_blank"
            rel="noopener noreferrer"
            >open issues</a
          >.
        </li>
        <li>
          Find the polyfill on
          <a
            href="https://www.npmjs.com/package/@oddbird/css-anchor-positioning"
            target="_blank"
            rel="noopener noreferrer"
            >npm</a
          >.
        </li>
        <li>
          Browse or open issues related to the specification
          <a
            href="https://github.com/w3c/csswg-drafts/labels/css-anchor-position-1"
            target="_blank"
            rel="noopener noreferrer"
            >here</a
          >
          or
          <a
            href="https://github.com/tabatkins/specs/issues?q=is%3Aissue+is%3Aopen+%5Bcss-anchor-position%5D"
            target="_blank"
            rel="noopener noreferrer"
            >here</a
          >.
        </li>
      </ul>
      <p>
        <strong>Note: </strong>We strive to keep the polyfill up-to-date with
        ongoing changes to the spec, and we welcome
        <a
          href="https://github.com/oddbird/css-anchor-positioning"
          target="_blank"
          rel="noopener noreferrer"
          >code contributions</a
        >
        and <a href="#sponsor">financial support</a> to make that happen.
      </p>
    </section>
    <section id="shadow-root" class="demo-item">
      <h2>
        <a href="#shadow-root" aria-hidden="true">üîó</a>
        Works if anchor and target are both inside the same shadow root
      </h2>
      <div class="demo-elements">
        <anchor-web-component>
          <template shadowrootmode="open">
            <link rel="stylesheet" href="/demo.css" />
            <link rel="stylesheet" href="/anchor-shadow-root.css" />
            <div style="position: relative">
              <div id="shadow-target-positioning" class="target">Target</div>
              <div id="shadow-anchor-positioning" class="anchor">Anchor</div>
            </div>
          </template>
        </anchor-web-component>
      </div>
      <div class="note">
        <p>
          With polyfill applied: Target and Anchor‚Äôs right edges line up.
          Target‚Äôs top edge lines up with the bottom edge of the Anchor.
        </p>
        <p>
          <strong>Note: </strong> this will not work across shadow root
          boundaries, and will not work with constructed stylesheets.
        </p>
      </div>

      <pre><code class="language-html"
>&lt;anchor-web-component&gt;
  &lt;template shadowrootmode="open"&gt;
    &lt;style&gt;
    #my-anchor-positioning {
      anchor-name: --my-anchor-positioning;
    }

    #my-target-positioning {
      position: absolute;
      top: anchor(--my-anchor-positioning bottom);
      right: anchor(--my-anchor-positioning right, 50px);
    }
    &lt;/style&gt;
    &lt;div style="position: relative"&gt;
      &lt;div id="my-target-positioning"&gt;Target&lt;/div&gt;
      &lt;div id="my-anchor-positioning"&gt;Anchor&lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
&lt;/anchor-web-component&gt;
&lt;script&gt;
class AnchorDemo extends HTMLElement {
  connectedCallback() {
    const stylesheets = this.shadowRoot.querySelectorAll('style');
    window.ANCHOR_POSITIONING_POLYFILL.call(this, { elements: [...stylesheets] });
  }
}
customElements.define("anchor-web-component", AnchorDemo);
&lt;/script&gt;
</code></pre>
    </section>
    <section id="sponsor">
      <h2>Sponsor OddBird‚Äôs OSS Work</h2>
      <p>
        At OddBird, we love contributing to the languages & tools developers
        rely on. We‚Äôre currently working on polyfills for new Popover & Anchor
        Positioning functionality, as well as CSS specifications for functions,
        mixins, and responsive typography. Help us keep this work sustainable
        and centered on your needs as a developer! We display sponsor logos and
        avatars on our
        <a
          href="https://www.oddbird.net/polyfill/#open-source-sponsors"
          target="_blank"
          rel="noopener noreferrer"
          >website</a
        >.
      </p>
      <a
        href="https://github.com/sponsors/oddbird"
        target="_blank"
        rel="noopener noreferrer"
        >Sponsor OddBird‚Äôs OSS Work</a
      >
    </section>
    <footer>
      <p>
        Spec proposal by
        <a
          href="http://xanthir.com/contact/"
          target="_blank"
          rel="noopener noreferrer"
          >Tab Atkins-Bittner</a
        >. Polyfill and demo by
        <a
          href="https://www.oddbird.net/"
          target="_blank"
          rel="noopener noreferrer"
          >OddBird</a
        >.
      </p>
    </footer>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Anchor Positioning Polyfill</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/prismjs@v1.x/themes/prism.css"
    />
    <script
      src="https://unpkg.com/@oddbird/popover-polyfill@latest/dist/popover.min.js"
      crossorigin="anonymous"
      defer
    ></script>
    <!-- TypeKit Fonts -->
    <script src="https://use.typekit.net/slx1xnq.js"></script>
    <script>
      try {
        Typekit.load({ async: true });
      } catch (e) {}
    </script>
    <link rel="stylesheet" href="/demo.css" />

    <link rel="stylesheet" href="/anchor.css" />
    <link rel="stylesheet" href="/anchor-positioning.css" />
    <link rel="stylesheet" href="/anchor-popover.css" />
    <link rel="stylesheet" href="/position-try.css" />
    <link rel="stylesheet" href="/position-try-tactics.css" />
    <link rel="stylesheet" href="/position-try-tactics-combined.css" />
    <link rel="stylesheet" href="/position-anchor.css" />
    <link rel="stylesheet" href="/anchor-scroll.css" />
    <link rel="stylesheet" href="/anchor-size.css" />
    <link rel="stylesheet" href="/anchor-size-extended.css" />
    <link rel="stylesheet" href="/anchor-math.css" />
    <link rel="stylesheet" href="/anchor-name-custom-prop.css" />
    <link rel="stylesheet" href="/anchor-name-list.css" />
    <link rel="stylesheet" href="/anchor-custom-props.css" />
    <link rel="stylesheet" href="/anchor-duplicate-custom-props.css" />
    <link rel="stylesheet" href="/anchor-update.css" />
    <link rel="stylesheet" href="/anchor-absolute.css" />
    <link rel="stylesheet" href="/anchor-pseudo-element.css" />
    <link rel="stylesheet" href="/anchor-media-query.css" />
    <link rel="stylesheet" href="/anchor-scope.css" />
    <link rel="stylesheet" href="/position-area.css" />
    <link rel="stylesheet" href="/anchor-inside-outside.css" />
    <link rel="stylesheet" href="/import-has-import.css" />
    <!-- Included to test invalid stylesheets -->
    <link rel="stylesheet" href="/fake.css" />
    <style>
      #my-anchor-style-tag {
        anchor-name: --my-anchor-style-tag;
      }

      #my-target-style-tag {
        position: absolute;
        bottom: anchor(--my-anchor-style-tag start);
        right: anchor(--my-anchor-style-tag left);
      }

      #anchor-manual .anchor {
        inline-size: fit-content;
        margin: 3rem auto;
      }
    </style>
    <script type="module">
      import polyfill from '/src/index-fn.ts';

      const SUPPORTS_ANCHOR_POSITIONING =
        'anchorName' in document.documentElement.style;

      const btn = document.getElementById('apply-polyfill');

      if (!SUPPORTS_ANCHOR_POSITIONING) {
        btn.addEventListener('click', () =>
          polyfill().then((rules) => {
            btn.innerText = 'Polyfill Applied';
            btn.setAttribute('disabled', '');
            console.log(rules);
          }),
        );
      } else {
        btn.innerText = 'No Polyfill Needed';
        btn.setAttribute('disabled', '');
        console.log(
          'anchor-positioning is supported in this browser; polyfill skipped.',
        );
      }

      const updateBtn = document.getElementById('toggle-anchor-width');
      const updateAnchor = document.getElementById('my-anchor-update');
      updateBtn.addEventListener('click', () => {
        if (updateAnchor.getAttribute('data-small')) {
          updateAnchor.setAttribute('data-large', true);
          updateAnchor.removeAttribute('data-small');
        } else {
          updateAnchor.setAttribute('data-small', true);
          updateAnchor.removeAttribute('data-large');
        }
      });

      function prepareManualPolyfill() {
        // anchor style element
        const anchorStyleEl = document.createElement('style');
        anchorStyleEl.id = 'my-style-manual-anchor';
        anchorStyleEl.textContent = [
          '#my-anchor-manual {',
          'anchor-name: --my-anchor-manual;',
          '}',
        ].join('');

        // style element
        const styleEl = document.createElement('style');
        styleEl.id = 'my-style-manual-style-el';
        styleEl.textContent = [
          '#my-target-manual-style-el {',
          'position: absolute;',
          'bottom: anchor(--my-anchor-manual top);',
          'right: anchor(--my-anchor-manual left);',
          '}',
        ].join('');

        // link element
        const linkEl = document.createElement('link');
        linkEl.id = 'my-style-manual-link-el';
        linkEl.rel = 'stylesheet';
        linkEl.href = '/anchor-manual.css';

        document.head.append(anchorStyleEl, styleEl, linkEl);

        // inline style
        document
          .getElementById('my-target-manual-inline-style')
          ?.setAttribute(
            'style',
            [
              'position: absolute',
              'top: anchor(--my-anchor-manual bottom)',
              'left: anchor(--my-anchor-manual right)',
            ].join(';'),
          );
      }

      // These event listeners are for E2E testing only
      document
        .getElementById('prepare-manual-polyfill')
        ?.addEventListener('click', () => prepareManualPolyfill(), {
          once: true,
        });
      const manualSet1Button = document.getElementById(
        'apply-polyfill-manually-set1',
      );
      manualSet1Button?.addEventListener('click', (e) => {
        polyfill({
          elements: [
            document.getElementById('my-style-manual-anchor'),
            document.getElementById('my-style-manual-style-el'),
          ],
          excludeInlineStyles: true,
        }).then(() => {
          manualSet1Button.setAttribute('disabled', '');
        });
      });
      const manualSet2Button = document.getElementById(
        'apply-polyfill-manually-set2',
      );
      manualSet2Button?.addEventListener('click', (e) => {
        polyfill({
          elements: [
            document.getElementById('my-style-manual-anchor'),
            document.getElementById('my-style-manual-link-el'),
            document.getElementById('my-target-manual-inline-style'),
          ],
          excludeInlineStyles: true,
        }).then(() => {
          manualSet2Button.setAttribute('disabled', '');
        });
      });
      const manualSet3Button = document.getElementById(
        'apply-polyfill-manually-set3',
      );
      manualSet3Button?.addEventListener('click', (e) => {
        polyfill({
          elements: [
            document.getElementById('my-style-manual-anchor'),
            document.getElementById('my-style-manual-style-el'),
          ],
        }).then(() => {
          manualSet3Button.setAttribute('disabled', '');
        });
      });

      const manualBtn = document.getElementById('apply-polyfill-manually');
      if (SUPPORTS_ANCHOR_POSITIONING) {
        manualBtn.innerText = 'Load Anchor Positioning CSS';
      }
      manualBtn.addEventListener('click', () => {
        prepareManualPolyfill();

        if (!SUPPORTS_ANCHOR_POSITIONING) {
          polyfill({
            elements: [
              document.getElementById('my-style-manual-anchor'),
              document.getElementById('my-style-manual-link-el'),
              document.getElementById('my-style-manual-style-el'),
              document.getElementById('my-target-manual-inline-style'),
            ],
          }).then((rules) => {
            manualBtn.innerText = 'Polyfill Applied';
            manualBtn.setAttribute('disabled', '');
            console.log(rules);
          });
        } else {
          manualBtn.innerText = 'Anchor Positioning CSS applied';
          console.log(
            'anchor-positioning is supported in this browser; polyfill skipped.',
          );
        }
        manualBtn.setAttribute('disabled', '');
      });
    </script>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script>
    <script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script>
    <script
      defer
      data-domain="anchor-positioning.oddbird.net"
      src="https://plausible.io/js/script.hash.outbound-links.js"
    ></script>
  </head>
  <body>
    <header>
      <h1><a href="/">CSS Anchor Positioning Polyfill</a></h1>
      <nav>
        <span> See also: </span>
        <a
          href="https://github.com/web-platform-tests/wpt/tree/master/css/css-anchor-position"
          target="_blank"
          rel="noopener noreferrer"
          >WPT examples</a
        >
        <!-- <a
          href="https://anchor-position-wpt.netlify.app/"
          target="_blank"
          rel="noopener noreferrer"
          >WPT results</a
        > -->
        <a
          href="https://drafts.csswg.org/css-anchor-position/"
          target="_blank"
          rel="noopener noreferrer"
          >Draft Spec</a
        >
      </nav>
      <button id="apply-polyfill" data-button="apply-polyfill" type="button">
        Apply Polyfill
      </button>
    </header>
    <section>
      <h2>Anchoring Elements Using CSS</h2>
      <p>
        The CSS anchor positioning
        <a
          href="https://drafts.csswg.org/css-anchor-position/"
          target="_blank"
          rel="noopener noreferrer"
          >specification</a
        >
        defines anchor positioning, “where a positioned element can size and
        position itself relative to one or more ‘anchor elements’ elsewhere on
        the page.” This CSS Anchor Positioning Polyfill supports and is based on
        this specification.
      </p>
      <p>
        The proposed <code>anchor()</code> and
        <code>anchor-size()</code> functions add flexibility to how absolutely
        positioned elements can be placed within a layout. Instead of being
        sized and positioned based solely on the position of their containing
        block, the proposed new functions allow absolutely positioned elements
        to be placed relative to one or more author-defined anchor elements.
      </p>
      <ul>
        <li>
          View the polyfill on
          <a
            href="https://github.com/oddbird/css-anchor-positioning"
            target="_blank"
            rel="noopener noreferrer"
            >GitHub</a
          >
          or browse
          <a
            href="https://github.com/oddbird/css-anchor-positioning/issues"
            target="_blank"
            rel="noopener noreferrer"
            >open issues</a
          >.
        </li>
        <li>
          Find the polyfill on
          <a
            href="https://www.npmjs.com/package/@oddbird/css-anchor-positioning"
            target="_blank"
            rel="noopener noreferrer"
            >npm</a
          >.
        </li>
        <li>
          Browse or open issues related to the specification
          <a
            href="https://github.com/w3c/csswg-drafts/labels/css-anchor-position-1"
            target="_blank"
            rel="noopener noreferrer"
            >here</a
          >
          or
          <a
            href="https://github.com/tabatkins/specs/issues?q=is%3Aissue+is%3Aopen+%5Bcss-anchor-position%5D"
            target="_blank"
            rel="noopener noreferrer"
            >here</a
          >.
        </li>
      </ul>
      <p>
        <strong>Note: </strong>We strive to keep the polyfill up-to-date with
        ongoing changes to the spec, and we welcome
        <a
          href="https://github.com/oddbird/css-anchor-positioning"
          target="_blank"
          rel="noopener noreferrer"
          >code contributions</a
        >
        and <a href="#sponsor">financial support</a> to make that happen.
      </p>
    </section>
    <section id="anchor-positioning" class="demo-item">
      <h2>
        <a href="#anchor-positioning" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [stylesheet]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-target-positioning" class="target">Target</div>
        <div id="my-anchor-positioning" class="anchor">Anchor</div>
      </div>
      <p class="note">
        With polyfill applied: Target and Anchor’s right edges line up. Target’s
        top edge lines up with the bottom edge of the Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-positioning {
  anchor-name: --my-anchor-positioning;
}

#my-target-positioning {
  position: absolute;
  top: anchor(--my-anchor-positioning bottom);
  right: anchor(--my-anchor-positioning right, 50px);
}</code></pre>
    </section>
    <section id="anchor-style-tag" class="demo-item">
      <h2>
        <a href="#anchor-style-tag" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [&lt;style&gt; tag]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-target-style-tag" class="target">Target</div>
        <div id="my-anchor-style-tag" class="anchor">Anchor</div>
      </div>
      <p class="note">
        With polyfill applied: Target is positioned at the top left corner of
        the Anchor.
      </p>
      <pre><code class="language-css"
>/* a &lt;style&gt; tag */

#my-anchor-style-tag {
  anchor-name: --my-anchor-style-tag;
}

#my-target-style-tag {
  position: absolute;
  bottom: anchor(--my-anchor-style-tag start);
  right: anchor(--my-anchor-style-tag left);
}</code></pre>
    </section>
    <section id="anchor-inline" class="demo-item">
      <h2>
        <a href="#anchor-inline" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [inline styles]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div
          id="my-target-inline"
          class="target"
          style="
            position: absolute;
            top: anchor(--my-anchor-in-line bottom);
            right: anchor(--my-anchor-in-line right);
          "
        >
          Target
        </div>
        <div
          id="my-anchor-inline"
          class="anchor"
          style="anchor-name: --my-anchor-in-line"
        >
          Anchor
        </div>
      </div>
      <p class="note">
        With polyfill applied: Target and Anchor’s right edges line up. Target’s
        top edge lines up with the bottom edge of the Anchor.
      </p>
      <pre><code class="language-css"
>/* inline &lt;style&gt; attributes */

/* anchor */

  style="anchor-name: --my-anchor-in-line"

/* target */

  style="
    position: absolute;
    top: anchor(--my-anchor-in-line bottom);
    right: anchor(--my-anchor-in-line right);
  "</code></pre>
    </section>
    <section id="position-anchor" class="demo-item">
      <h2>
        <a href="#position-anchor" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [
        <code>position-anchor</code> property]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-position-anchor-a" class="anchor">Anchor A</div>
        <div id="my-position-target-a" class="target">Target A</div>
        <div id="my-position-anchor-b" class="anchor">Anchor B</div>
        <div id="my-position-target-b" class="target">Target B</div>
      </div>
      <p class="note">
        With polyfill applied: Targets are positioned at the top right corner of
        their respective Anchors.
      </p>
      <pre><code class="language-html"
>&lt;div id="my-position-anchor-a" class="anchor"&gt;Anchor A&lt;/div&gt;
&lt;div id="my-position-target-a" class="target"&gt;Target A&lt;/div&gt;
&lt;div id="my-position-anchor-b" class="anchor"&gt;Anchor B&lt;/div&gt;
&lt;div id="my-position-target-b" class="target"&gt;Target B&lt;/div&gt;</code>

<code class="language-css"
>#my-position-target-a {
  position-anchor: --my-position-anchor-a;
}

#my-position-target-b {
  position-anchor: --my-position-anchor-b;
}

.target {
  position: absolute;
  bottom: anchor(top);
  left: anchor(right);
}

#my-position-anchor-a {
  anchor-name: --my-position-anchor-a;
}

#my-position-anchor-b {
  anchor-name: --my-position-anchor-b;
}</code></pre>
    </section>
    <section id="anchor-positioning-popover" class="demo-item">
      <h2>
        <a href="#anchor-positioning-popover" aria-hidden="true">🔗</a>
        Anchoring a <code>popover</code>
      </h2>
      <div style="position: relative" class="demo-elements">
        <button
          id="my-anchor-popover"
          class="anchor"
          popovertarget="my-target-popover"
        >
          Anchor (click to open)
        </button>
        <div id="my-target-popover" class="target" popover>
          Popover (Target)
        </div>
      </div>
      <p class="note">
        With polyfill applied: Target is positioned at the bottom right corner
        of the Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-popover {
  position: absolute;
  left: 200px;
  anchor-name: --my-anchor-popover;
}

#my-target-popover {
  position: absolute;
  left: anchor(--my-anchor-popover right);
  top: anchor(--my-anchor-popover bottom);
}</code></pre>
    </section>
    <section id="custom-prop-name" class="demo-item">
      <h2>
        <a href="#custom-prop-name" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [anchor name set as CSS custom
        property]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-name-prop" class="anchor">Anchor</div>
        <div id="my-target-name-prop" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target is positioned at the top left corner of
        the Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-name-prop {
  anchor-name: --my-anchor-name-prop;
}

#my-target-name-prop {
  --anchor-var: --my-anchor-name-prop;

  position: absolute;
  right: anchor(var(--anchor-var) left);
  bottom: anchor(var(--anchor-var) top);
}</code></pre>
    </section>
    <section id="inside-outside" class="demo-item">
      <h2>
        <a href="#inside-outside" aria-hidden="true">🔗</a>
        Positioning using <code>inside</code> and <code>outside</code> values
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="anchor">Anchor</div>
        <div class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target’s bottom edge is aligned with Anchor’s
        bottom edge, and Target’s left edge is aligned with Anchor’s right edge.
      </p>
      <pre><code class="language-css"
>#inside-outside .anchor {
  anchor-name: --inside-outside;
}

#inside-outside .target {
  position: absolute;
  position-anchor: --inside-outside;
  left: anchor(outside);
  bottom: anchor(inside);
}</code></pre>
    </section>
    <section id="position-try-tactics" class="demo-item">
      <h2>
        <a href="#position-try-tactics" aria-hidden="true">🔗</a>
        Fallbacks with <code>position-try-fallbacks</code>
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="scroll-container">
          <div class="placefiller-above-anchor"></div>
          <div class="placefiller-before-anchor"></div>
          <span id="my-anchor-try-tactics" class="anchor"
            >position-try-fallbacks Anchor</span
          >
          <div id="my-target-try-tactics" class="target">Target</div>
          <span id="my-anchor-try-tactics-2" class="anchor"
            >position-try-fallbacks Anchor 2</span
          >
          <div id="my-target-try-tactics-2" class="target">Target 2</div>
          <div class="placefiller-after-anchor"></div>
        </div>
      </div>
      <div class="note">
        <p>
          With polyfill applied, the following positions are attempted in order:
        </p>
        <ol>
          <li>
            Align the bottom, left edge of the target with the top, right edge
            of its anchor.
          </li>
          <li>
            Apply <code>flip-block</code>, flipping across the inline axis, and
            align the top, left edge of the target with the bottom, right edge
            of its anchor.
          </li>
          <li>
            Apply <code>flip-inline</code>, flipping across the block axis, and
            align the bottom, right edge of the target with the top, left edge
            of its anchor.
          </li>
          <li>
            Apply <code>flip-start</code>, flipping across a diagonal line from
            upper left to lower right, and align the top, right edge of the
            target with the bottom, left edge of its anchor.
          </li>
          <li>
            When every position overflows, revert to the last successful
            fallback position if there is one, otherwise revert to the initial
            base styles.
          </li>
        </ol>
        <p>
          <strong>Note:</strong> Early Chromium implementations used
          <code>position-try-options</code> instead of
          <code>position-try-fallbacks</code>. We recommend adding both
          properties, or using the <code>position-try</code> shorthand.
        </p>
      </div>
      <pre><code class="language-css"
>#my-anchor-try-tactics {
  anchor-name: --my-anchor-try-tactics;
}

#my-anchor-try-tactics-2 {
  anchor-name: --my-anchor-try-tactics-2;
}

#my-target-try-tactics {
  position-anchor: --my-anchor-try-tactics;
}

#my-target-try-tactics-2 {
  position-anchor: --my-anchor-try-tactics-2;
}

#my-target-try-tactics,
#my-target-try-tactics-2 {
  position: absolute;
  bottom: anchor(top);
  left: anchor(right);
  position-try-fallbacks: flip-block, flip-inline, flip-start;
}</code></pre>
    </section>
    <section id="position-try" class="demo-item">
      <h2>
        <a href="#position-try" aria-hidden="true">🔗</a>
        Fallbacks with <code>position-try-fallbacks</code> and
        <code>@position-try</code>
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="scroll-container">
          <div class="placefiller-above-anchor"></div>
          <div class="placefiller-before-anchor"></div>
          <span id="my-anchor-fallback" class="anchor"
            >@position-try Anchor</span
          >
          <div id="my-target-fallback" class="target">Target</div>
          <span id="my-anchor-fallback-2" class="anchor"
            >@position-try Anchor 2</span
          >
          <div id="my-target-fallback-2" class="target">Target 2</div>
          <div class="placefiller-after-anchor"></div>
        </div>
      </div>
      <div class="note">
        <p>
          With polyfill applied, the following positions are attempted in order:
        </p>
        <ol>
          <li>
            Align the bottom, left edge of the target with the top, left edge of
            its anchor.
          </li>
          <li>
            Align the top, left edge of the target with the bottom, left edge of
            its anchor.
          </li>
          <li>
            Align the bottom, right edge of the target with the top, right edge
            of its anchor.
          </li>
          <li>
            Align the top, right edge of the target with the bottom, right edge
            of its anchor, and set the height and width of the target to 100px.
          </li>
          <li>
            When every position overflows, revert to the last successful
            fallback position if there is one, otherwise revert to the initial
            base styles.
          </li>
        </ol>
      </div>
      <pre><code class="language-css"
>#my-anchor-fallback {
  anchor-name: --my-anchor-fallback;
}

#my-anchor-fallback-2 {
  anchor-name: --my-anchor-fallback-2;
}

#my-target-fallback {
  position-anchor: --my-anchor-fallback;
}

#my-target-fallback-2 {
  position-anchor: --my-anchor-fallback-2;
}

#my-target-fallback,
#my-target-fallback-2 {
  position: absolute;

  /* First try to align the bottom, left edge of the target
     with the top, left edge of the anchor. */
  bottom: anchor(top);
  left: anchor(left);
  width: anchor-size(width);
  position-try-fallbacks: --bottom-left, --top-right, --bottom-right;
}

@position-try --bottom-left {
  /* Next try to align the top, left edge of the target
     with the bottom, left edge of the anchor. */
  top: anchor(bottom);
  left: anchor(left);
  /* Values set by the initial styles will still be applied
     unless they are explicitly reverted. */
  bottom: revert;
}

@position-try --top-right {
  /* Next try to align the bottom, right edge of the target
     with the top, right edge of the anchor. */
  bottom: anchor(top);
  right: anchor(right);
  left: revert;
  width: revert;
}

@position-try --bottom-right {
  /* Finally, try to align the top, right edge of the target
     with the bottom, right edge of the anchor. */
  top: anchor(bottom);
  right: anchor(right);
  width: 100px;
  height: 100px;
  bottom: revert;
  left: revert;
}</code></pre>
    </section>
    <section id="position-try-tactics-combined" class="demo-item">
      <h2>
        <a href="#position-try-tactics-combined" aria-hidden="true">🔗</a>
        Positioning with combined try tactics
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="scroll-container">
          <div class="placefiller-above-anchor"></div>
          <div class="placefiller-before-anchor"></div>
          <span id="my-anchor-try-tactics-combined" class="anchor"
            >position-try Anchor</span
          >
          <div id="my-target-try-tactics-combined" class="target">Target</div>
          <div class="placefiller-after-anchor"></div>
        </div>
      </div>
      <div class="note">
        <p>
          With polyfill applied, the following positions are attempted in order:
        </p>
        <ol>
          <li>
            Align the bottom, left edge of the target with the top, right edge
            of the anchor.
          </li>
          <li>
            Apply <code>flip-block flip-inline</code>, flipping across both the
            block and inline axis, and align the top, right edge of the target
            with the bottom, left edge of the anchor.
          </li>
          <li>
            Apply <code>flip-inline --bottom-left-combined</code>, flipping
            across the block axis, and align the top, right edge of the target
            with the bottom, right edge of the anchor.
          </li>
          <li>
            When every position overflows, revert to the last successful
            fallback position if there is one, otherwise revert to the initial
            base styles.
          </li>
        </ol>
      </div>
      <pre><code class="language-css"
>#my-anchor-try-tactics-combined {
  anchor-name: --my-anchor-try-tactics-combined;
}

#my-target-try-tactics-combined {
  position: absolute;
  position-anchor: --my-anchor-try-tactics-combined;
  bottom: anchor(top);
  left: anchor(right);
  position-try: flip-block flip-inline, flip-inline --bottom-left-combined;
}

@position-try --bottom-left-combined {
  top: anchor(bottom);
  left: anchor(left);
  bottom: revert;
}</code></pre>
    </section>
    <section id="anchor-scroll" class="demo-item">
      <h2>
        <a href="#anchor-scroll" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [scrolling elements]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="scroll-container">
          <div class="placefiller-above-anchor"></div>
          <div class="placefiller-before-anchor"></div>
          <span id="scroll-anchor" class="anchor">Anchor</span>
          <div id="inner-anchored" class="target">Inner-anchored Target</div>
          <div class="placefiller-after-anchor"></div>
        </div>
        <div id="outer-anchored" class="target outer-anchored">
          Outer-anchored Target
        </div>
      </div>
      <p class="note">
        With polyfill applied: The Inner-anchored Target is positioned at the
        top right corner of the Anchor. The Outer-anchored Target is positioned
        at the bottom left corner of the Anchor.
      </p>
      <pre><code class="language-css"
>#scroll-anchor {
  anchor-name: --scroll-anchor;
}

#inner-anchored {
  position: absolute;
  bottom: anchor(--scroll-anchor top);
  left: anchor(--scroll-anchor end);
}

#outer-anchored {
  position: absolute;
  top: anchor(--scroll-anchor bottom);
  right: anchor(--scroll-anchor start);
}</code></pre>
    </section>
    <section id="math-function" class="demo-item">
      <h2>
        <a href="#math-function" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [used in
        <code>calc()</code> function]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-math" class="anchor">Anchor</div>
        <div id="my-target-math" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target’s left edge is 10px left of the Anchor’s
        right edge). The top edge of the Target is 10px below the bottom edge of
        the Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-math {
  anchor-name: --my-anchor-math;
}

#my-target-math {
  --full-math: anchor(--my-anchor-math 100%);
  --full-minus-math: calc(anchor(--my-anchor-math 100%) - 10px);

  position: absolute;
  top: calc(var(--full-math) + 10px);
  left: var(--full-minus-math);
}</code></pre>
    </section>
    <section id="custom-prop" class="demo-item">
      <h2>
        <a href="#custom-prop" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [passed through CSS custom
        property]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor" class="anchor">Anchor</div>
        <div id="my-target" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target’s top edge is positioned at 50% of the
        height of the Anchor. The right edge of the Target lines up with 100% of
        the width of the Anchor (i.e. the Anchor’s right edge).
      </p>
      <pre><code class="language-css"
>#my-anchor {
  anchor-name: --my-anchor;
}

#my-target {
  --center: anchor(--my-anchor 50%);
  --full: anchor(--my-anchor 100%);

  position: absolute;
  top: var(--center);
  right: var(--full);
}</code></pre>
    </section>
    <section id="custom-prop-passthrough" class="demo-item">
      <h2>
        <a href="#custom-prop-passthrough" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [passed through multiple CSS
        custom properties]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-props" class="anchor">Anchor</div>
        <div id="my-target-props" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target’s left edge is positioned in Anchor’s
        horizontal center. Target’s bottom edge is 10% above the bottom edge of
        Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-props {
  anchor-name: --my-anchor-props;
}

#my-target-props {
  --half: anchor(--my-anchor-props 50%);
  --quarter: calc(var(--half) / 2);
  --tenth: calc(var(--quarter) / 2.5);

  position: absolute;
  left: var(--half);
  bottom: var(--tenth);
}</code></pre>
    </section>
    <section id="duplicate-custom-props" class="demo-item">
      <h2>
        <a href="#duplicate-custom-props" aria-hidden="true">🔗</a>
        Positioning with <code>anchor()</code> [with duplicate CSS custom
        properties]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="anchor-duplicate-custom-props" class="anchor">Anchor</div>
        <div id="target-duplicate-custom-props" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target’s top left corner is positioned in the
        center (vertically and horizontally) of the Anchor.
      </p>
      <pre><code class="language-css"
>#anchor-duplicate-custom-props {
  anchor-name: --anchor-duplicate-custom-props;
}

#target-duplicate-custom-props {
  --center: anchor(--anchor-duplicate-custom-props 50%);

  position: absolute;
  top: var(--center);
  left: var(--center);
}

#other {
  --center: anchor(--anchor-duplicate-custom-props 100%);
}</code></pre>
    </section>
    <section id="position-area" class="demo-item">
      <h2>
        <a href="#position-area" aria-hidden="true">🔗</a>
        Positioning with <code>position-area</code>
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="anchor">Anchor</div>
        <div class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target is positioned to the top right of the
        Anchor. See <a href="position-area.html">more examples</a> of
        <code>position-area</code>.
      </p>
      <pre><code class="language-css"
>#position-area .anchor {
  anchor-name: --position-area-anchor;
}

#position-area .target {
  position: absolute;
  position-area: top right;
  position-anchor: --position-area-anchor;
}</code></pre>
    </section>
    <section id="anchor-size" class="demo-item">
      <h2>
        <a href="#anchor-size" aria-hidden="true">🔗</a>
        Sizing with <code>anchor-size()</code>
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-size" class="anchor">Anchor</div>
        <div id="my-target-size" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target has the same width as the Anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-size {
  anchor-name: --my-anchor;
  width: 5em;
}

#my-target-size {
  width: anchor-size(--my-anchor width);
}</code></pre>
    </section>
    <section
      id="anchor-size-extended"
      class="demo-item"
      style="position: relative"
    >
      <h2>
        <a href="#anchor-size-extended" aria-hidden="true">🔗</a>
        <code>anchor-size()</code> on margin and inset
      </h2>
      <div class="demo-elements">
        <div id="my-anchor-anchor-size-extended" class="anchor">Anchor</div>
        <div id="my-target-anchor-size-extended" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target's <code>margin</code> is the height of the
        anchor, and its <code>right</code> inset is the width of the anchor.
      </p>
      <pre><code class="language-css"
>#my-anchor-anchor-size-extended {
  anchor-name: --my-anchor-size-extended;
  resize: both;
  overflow: hidden;
}

#my-target-anchor-size-extended {
  position: absolute;
  position-anchor: --my-anchor-size-extended;
  right: anchor-size(width);
  margin: anchor-size(height);
}</code></pre>
    </section>
    <section id="anchor-update" class="demo-item">
      <h2>
        <a href="#anchor-update" aria-hidden="true">🔗</a>
        Dynamically update anchors
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-update" class="anchor">Anchor</div>
        <div id="my-target-update" class="target">Target</div>
      </div>
      <button id="toggle-anchor-width">Toggle anchor width</button>
      <p class="note">
        With polyfill applied: Target and Anchor’s right edges line up. Target’s
        top edge lines up with the bottom edge of the Anchor.
        <br />
        <br />
        When Anchor width is changed dynamically, Target position updates
        accordingly.
      </p>
      <pre><code class="language-css"
>#my-anchor-update {
  anchor-name: --my-anchor-update;
}

#my-target-update {
  position: absolute;
  right: anchor(--my-anchor-update right);
  top: anchor(--my-anchor-update bottom);
}</code></pre>
    </section>
    <section id="anchor-name-list" class="demo-item">
      <h2>
        <a href="#anchor-name-list" aria-hidden="true">🔗</a>
        Use a list of anchor names
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-name-list" class="anchor">Anchor</div>
        <div id="my-target-name-list-a" class="target">Target A</div>
        <div id="my-target-name-list-b" class="target">Target B</div>
      </div>
      <p class="note">
        With polyfill applied: Target A is positioned at Anchor’s top left
        corner. Target B is positioned at Anchor’s bottom right corner.
      </p>
      <pre><code class="language-css"
>#my-anchor-name-list {
  anchor-name: --my-anchor-name-a, --my-anchor-name-b;
}

#my-target-name-list-a {
  position: absolute;
  right: anchor(--my-anchor-name-a left);
  bottom: anchor(--my-anchor-name-a top);
}

#my-target-name-list-b {
  position: absolute;
  left: anchor(--my-anchor-name-b right);
  top: anchor(--my-anchor-name-b bottom);
}
</code></pre>
    </section>
    <section id="anchor-absolute" class="demo-item">
      <h2>
        <a href="#anchor-absolute" aria-hidden="true">🔗</a>
        Absolutely positioned anchor
      </h2>
      <div style="position: relative; height: 150px" class="demo-elements">
        <div id="my-anchor-absolute-one" class="anchor">Anchor one</div>
        <div id="my-target-absolute-one" class="target">Target one</div>
        <div id="my-anchor-absolute-two" class="anchor">Anchor two</div>
        <div id="my-target-absolute-two" class="target">Target two</div>
      </div>
      <p class="note">
        With polyfill applied: Target one is positioned at the bottom right
        corner of Anchor one. Target two is positioned at the bottom right
        corner of Anchor two.
      </p>
      <pre><code class="language-css"
>#my-anchor-absolute-one,
#my-anchor-absolute-two {
  position: absolute;
  anchor-name: --my-anchor-absolute;
}

#my-target-absolute-one,
#my-target-absolute-two {
  position: absolute;
  top: anchor(--my-anchor-absolute bottom);
  left: anchor(--my-anchor-absolute right);
}</code></pre>
    </section>
    <section id="anchor-pseudo-element" class="demo-item">
      <h2>
        <a href="#anchor-pseudo-element" aria-hidden="true">🔗</a>
        Pseudo-element anchor
      </h2>
      <div style="position: relative" class="demo-elements">
        <div class="scroll-container">
          <div class="placefiller-above-anchor"></div>
          <div class="placefiller-before-anchor"></div>
          <span id="my-anchor-pseudo-element" class="anchor">Anchor</span>
          <div class="placefiller-after-anchor"></div>
        </div>

        <div id="my-target-pseudo-element" class="target">Target</div>
      </div>
      <p class="note">
        Target is positioned at the bottom right corner of the Anchor’s
        <code>::before</code> pseudo-element.
      </p>
      <pre><code class="language-css"
>#my-anchor-pseudo-element::before {
  content: '::before';
  anchor-name: --my-anchor-pseudo-element;
}

#my-target-pseudo-element {
  position: absolute;
  position-anchor: --my-anchor-pseudo-element;
  top: anchor(bottom);
  left: anchor(right);
}</code></pre>
    </section>
    <section id="anchor-declared-in-media-query" class="demo-item">
      <h2>
        <a href="#anchor-declared-in-media-query" aria-hidden="true">🔗</a>
        Anchor declared in media query
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-media-query" class="anchor">Screen Anchor</div>
        <div id="my-print-anchor-media-query" class="anchor">Print Anchor</div>
        <div id="my-target-media-query" class="target">Target</div>
      </div>
      <p class="note">
        With polyfill applied: Target and Screen Anchor’s right and top edges
        line up.
      </p>
      <pre><code class="language-css"
>@media print {
  #my-print-anchor-media-query {
    anchor-name: --my-anchor-media-query;
  }
}

#my-anchor-media-query {
  anchor-name: --my-anchor-media-query;
}

#my-target-media-query {
  position: absolute;
  top: anchor(--my-anchor-media-query top);
  right: anchor(--my-anchor-media-query right);
}</code></pre>
    </section>
    <section id="anchor-manual" class="demo-item" style="position: relative">
      <h2>
        <a href="#manual" aria-hidden="true">🔗</a>
        Manually apply polyfill to specific styles
      </h2>
      <button id="apply-polyfill-manually">Polyfill these elements</button>
      <div id="anchor-manual-test-buttons" hidden>
        <!-- These buttons are for E2E testing only -->
        <button id="prepare-manual-polyfill">Prepare</button>
        <button id="apply-polyfill-manually-set1">Polyfill target 1</button>
        <button id="apply-polyfill-manually-set2">
          Polyfill target 2 and 3
        </button>
        <button id="apply-polyfill-manually-set3">
          Polyfill target 1 and 3
        </button>
      </div>
      <div class="demo-elements">
        <div id="my-anchor-manual" class="anchor">Anchor</div>
        <div id="my-target-manual-style-el" class="target">
          Target 1 (with <code>&lt;style&gt;</code>)
        </div>
        <div id="my-target-manual-link-el" class="target">
          Target 2 (with <code>&lt;link&gt;</code>)
        </div>
        <div id="my-target-manual-inline-style" class="target">
          Target 3 (with inline style)
        </div>
      </div>
      <p class="note">
        With polyfill applied: Target 1, 2, and 3 are positioned at Anchor’s
        top-left, top-right, and bottom-right corners respectively.
      </p>
      <pre><code class="language-html" data-dependencies="css,js">&lt;style id="my-style-manual-anchor"&gt;
  #my-anchor-manual {
    anchor-name: --my-anchor-manual;
  }
&lt;/style&gt;
&lt;style id="my-style-manual-style-el"&gt;
  #my-target-manual-style-el {
    position: absolute;
    bottom: anchor(--my-anchor-manual top);
    right: anchor(--my-anchor-manual left);
  }
&lt;/style&gt;
&lt;link rel="stylesheet" href="/anchor-manual.css" id="my-style-manual-link-el" /&gt;
&lt;!--
CSS inside the anchor-manual.css file:

#my-target-manual-link-el {
  position: absolute;
  bottom: anchor(--my-anchor-manual top);
  left: anchor(--my-anchor-manual right);
}
--&gt;

&lt;div id="my-anchor-manual" class="anchor"&gt;...&lt;/div&gt;
&lt;div id="my-target-manual-style-el" class="target"&gt;...&lt;/div&gt;
&lt;div id="my-target-manual-link-el" class="target"&gt;...&lt;/div&gt;
&lt;div id="my-target-manual-inline-style" class="target"
  style="position: absolute;
    top: anchor(--my-anchor-manual bottom);
    left: anchor(--my-anchor-manual right);"
&gt;...&lt;/div&gt;

&lt;script&gt;
  polyfill({
    elements: [
      // The &lt;style&gt; element for anchor
      document.getElementById('my-style-manual-anchor'),
      // The &lt;style&gt; element
      document.getElementById('my-style-manual-style-el'),
      // The &lt;link&gt; element
      document.getElementById('my-style-manual-link-el'),
      // The target element with inline styles
      document.getElementById('my-target-manual-inline-style'),
    ],
  });
&lt;/script&gt;</code></pre>
    </section>
    <section id="anchor-scope" class="demo-item">
      <h2>
        <a href="#anchor-scope" aria-hidden="true">🔗</a>
        Scope an anchor name
      </h2>
      <div class="demo-elements">
        <ul>
          <li class="anchor">
            <span>List item One</span><span class="arrow">▶</span>
            <div class="target scoped-target">Target One</div>
          </li>
          <li class="anchor">
            <span>List item Two</span><span class="arrow">▶</span>
            <div class="target scoped-target">Target Two</div>
          </li>
          <li class="anchor">
            <span>List item Three</span><span class="arrow">▶</span>
            <div class="target scoped-target">Target Three</div>
          </li>
          <li class="anchor">
            <span>List item Four</span><span class="arrow">▶</span>
            <div class="target scoped-target">Target Four</div>
          </li>
          <li class="anchor">
            <span>List item Five</span><span class="arrow">▶</span>
            <div class="target scoped-target">Target Five</div>
          </li>
        </ul>
      </div>
      <p class="note">
        With polyfill applied: Targets are positioned to the right of their
        corresponding item’s arrow.
      </p>
      <pre><code class="language-css">#anchor-scope li {
  anchor-scope: --anchor-scope;
}

#anchor-scope .arrow {
  anchor-name: --anchor-scope;
}

#anchor-scope .target {
  position: absolute;
  position-anchor: --anchor-scope;
  left: anchor(right);
  top: anchor(center);
}</code></pre>
    </section>
    <section id="imports" class="demo-item">
      <h2>
        <a href="#imports" aria-hidden="true">🔗</a>
        Works with CSS @imports
      </h2>
      <div class="demo-elements">
        <div class="anchor">Anchor</div>
        <div class="target" id="target-1">Target One</div>
        <div class="target" id="target-2">Target Two</div>
      </div>
      <div class="note">
        <p>
          With polyfill applied: Target and Anchor text is orange (from styles
          defined in an imported stylesheet). Target One is positioned at the
          bottom right corner of the Anchor. The Anchor has an envelope icon on
          both sides of the text.
        </p>
        <p>
          <strong>Note:</strong> Target Two has
          <code>position-area</code> defined in an imported stylesheet, which is
          not parsed by the polyfill, so it is not positioned correctly. It
          should be positioned at the bottom left corner.
        </p>
      </div>
      <pre><code class="language-css">@import url('./import-is-imported-url.css') supports(display: grid) screen and (min-width: 400px);
@import './import-is-imported-string.css';

#imports .anchor::after {
  content: url('./mail.svg');
}

/* ./import-is-imported-url.css */
#imports #target-1 {
  color: var(--brand-orange);
}

#imports #target-2 {
  position-area: block-end inline-start;
  color: var(--brand-orange);
}

#imports .anchor::before {
  content: url('./mail.svg');
}

/* ./import-is-imported-string.css */
#imports .anchor {
  color: var(--brand-orange);
}</code></pre>
    </section>
    <section id="shadow-dom">
      <h2>
        <a href="#shadow-com" aria-hidden="true">🔗</a>
        Positioning within the shadow DOM
      </h2>
      <p class="note">
        The polyfill can position targets and anchors inside a shadow root. See
        <a href="shadow-dom.html">shadow DOM examples</a>.
      </p>
    </section>
    <section id="sponsor">
      <h2>Sponsor OddBird’s OSS Work</h2>
      <p>
        At OddBird, we love contributing to the languages & tools developers
        rely on. We’re currently working on polyfills for new Popover & Anchor
        Positioning functionality, as well as CSS specifications for functions,
        mixins, and responsive typography. Help us keep this work sustainable
        and centered on your needs as a developer! We display sponsor logos and
        avatars on our
        <a
          href="https://www.oddbird.net/polyfill/#open-source-sponsors"
          target="_blank"
          rel="noopener noreferrer"
          >website</a
        >.
      </p>
      <a
        href="https://github.com/sponsors/oddbird"
        target="_blank"
        rel="noopener noreferrer"
        >Sponsor OddBird’s OSS Work</a
      >
    </section>
    <footer>
      <p>
        Spec proposal by
        <a
          href="http://xanthir.com/contact/"
          target="_blank"
          rel="noopener noreferrer"
          >Tab Atkins-Bittner</a
        >. Polyfill and demo by
        <a
          href="https://www.oddbird.net/"
          target="_blank"
          rel="noopener noreferrer"
          >OddBird</a
        >.
      </p>
    </footer>
  </body>
</html>
